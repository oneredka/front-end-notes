# 移动端性能优化

 

## 初识移动端性能优化



### 什么是性能

- 页面的响应速度



页面的响应速度

- 打开页面到实际能够正常使用的时间
  - 网络请求的时间
  - 页面加载和渲染的时间
- 与页面进行交互的流畅程度
  - Javascript脚本的执行速度

ps:**更快地加载页面首屏内容，无需考虑整张页面**





### 为什么需要优化移动端的性能

- 提升用户体验
- 与PC端相比，移动端网络速度慢
- 与PC端相比，移动端设备性能低





### 学什么

- 各阶段的性能优化点
- 具体的性能优化策略



## 网络请求过程中的优化点

![image-20210808140219787](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808140224.png)





![image-20210808153027628](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808153058.png)



### Chrome Dev Tool 中时间线各阶段代表的意义

![img](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808153553.png)



> 在请求能够被发出去前的等等时间。包含了用于处理代理的时间。
>
> 另外，如果有已经建立好的连接，那么这个时间还包括等待已建立连接被复用的时间，这个遵循Chrome对同一源最大6个TCP连接的规则。

#### Proxy Negotiation

- 与代理服务器连接的协商的时间。



#### DNS Lookup

- 用于执行DNS查找时间。页面上的每一个新域需要一个完整的来回做DNS查找。



#### Initial Connection / Connecting

- 用于建立链接的时间，包括TCP握手及多次尝试握手，还有处理SSL。



##### SSL

- 完成SSL握手的时间。



#### Request Sent / Sending

- 发起请求的时间



#### Waiting (TTFB)

- 请求发出后，到收到响应的第一个字节所花费的时间(Time To First Byte)



##### Content Download / Downloading

- 用于下载响应的时间





### 将多个资源分布在不同域上，减少请求队列的等待时间

- 浏览器为每个域名分配的并发通道有限
- 多个域意味着更多的DNS查询时间，通常把域名拆分到3~5个比较合适



### 通过dns-prefetch减少DNS查询时间

- 尝试在请求资源之前解析域名

![image-20210808154751054](C:\Users\云牧丫\AppData\Roaming\Typora\typora-user-images\image-20210808154751054.png)

- 仅对跨域域上的DNS查找有效
- 已经解析过的域名不要再添加dns-prefetch

![image-20210808160227620](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808160230.png)



### 减少HTTP请求数量

- 资源的合并(合并CSS、JS文件)
- 内联首屏相关代码
- 使用缓存(浏览器缓存、localStorage 等)



```css
<!-- <link rel="stylesheet" href="./css/reset.css" />
<link rel="stylesheet" href="./css/base.css" />
<link rel="stylesheet" href="./css/index.css" /> -->

<!-- <link rel="stylesheet" href="./css/index.css" /> -->
	
<!-- 1.合并后的资源不能过大 -->
<!-- 2.考虑缓存的问题 -->
<link rel="stylesheet" href="./css/common.css" />
<link rel="stylesheet" href="./css/index.css" />
```





![image-20210808155826790](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808155829.png)





### 减少请求资源的大小

- 资源的压缩(HTML、 CSS 的压缩以及JS的压缩和混淆)
- 开启Gzip压缩
- 减少Cookie体积

![image-20210808160820574](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808160822.png)



![image-20210808161043125](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808161044.png)



![image-20210808161218443](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808161220.png)







## 页面加载和渲染过程中的优化点

![image-20210808161253990](C:\Users\云牧丫\AppData\Roaming\Typora\typora-user-images\image-20210808161253990.png)



- CSS - -般在head中引入
- JavaScript一般在body末尾引入



![image-20210808161929826](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210808161956.png)

- 减少回流/重布局/重排(Reflow/Relayout) 与重绘(Repaint)
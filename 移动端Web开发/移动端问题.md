# 移动端Web常见问题

有哪些

- 1px边框
- click事件300ms延迟
- Touch事件点击穿透
- 移动端图片





## 1px边框



![设计稿](https://raw.githubusercontent.com/xixixiaoyu/cloundImg/main/img/20210811172202.png)



### 1.高清屏下，1px 边框“变粗”的原因

- 并不是真的变粗了，而是设计想要的 1像素，不是程序员眼中的 1CSS像素，而是 1物理像素
-  如果 dpr=2，设计实际想要的就是 1px/2=0.5px
-  如果 dpr=3，设计实际想要的就是 1px/3=0.3333px



### 2.解决方案

- 和设计商量，如果不在意这个问题，不用去管
- 直接设置“细”边框
  - 存在兼容性问题，不同的浏览器会有不同的表现
  - 对于 iOS8 以后的 iOS 系统推荐使用这种方法
- 伪类 + transform（推荐）
- **其他方案可参考：https://www.cnblogs.com/zzsdream/articles/6004933.html**



**具体实现**

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1px 边框</title>
    <style>
      body {
        background-color: #f5f5f5;
      }

      .list {
        padding: 0;
        margin: 0;
        font-size: 30px;
      }
      .item {
        list-style: none;
        line-height: 60px;
        border-bottom: 1px solid #ccc;
      }

      /* 直接设置“细”边框 */
      .item1 {
        border-width: 0.5px;
      }

      /* 伪类 + transform */
      @media (-webkit-min-device-pixel-ratio: 2) {
        .border-1px {
          position: relative;
          border: none;
        }
         /* 往后添加一个伪类去设置边框 */
        .border-1px::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          /* 将来会用scale缩小一半 */
          width: 200%;
          height: 200%;
          /* 设置相应边框 */
          border-bottom: 1px solid #ccc;
          /* border: 1px solid #ccc; */
          /* 设置圆角 */
          /* border-radius: 20px; */
          transform-origin: 0 0;
          transform: scale(0.5);

          /* background-color: rgba(255, 0, 0, 0.5); */
        }
      }
      @media (-webkit-min-device-pixel-ratio: 3) {
        .border-1px::after {
          width: 300%;
          height: 300%;
          transform: scale(0.3333);
        }
      }
    </style>
  </head>
  <body>
    <ul class="list">
      <li class="item">“变粗”的 1px 边框</li>
      <!-- <li class="item">变粗的原因</li>
      <li class="item">解决方案</li> -->
      <li class="item item1">直接设置“细”边框</li>
      <li class="item border-1px">伪类 + transform</li>
    </ul>
  </body>
</html>

```





## 点击穿透

> 移动端 `click` 屏幕产生 200-300 ms 的延迟响应，往往会造成按钮点击延迟甚至是点击失效。

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>click 事件 300ms 延迟</title>
    <style>
      .btn {
        width: 100%;
        height: 300px;
        font-size: 100px;

        /* touch-action: manipulation; */
      }
    </style>
  </head>
  <body>
    <button id="btn" class="btn">提交</button>

    <script src="https://cdn.bootcdn.net/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      const $btn = document.getElementById('btn');
      $btn.addEventListener(
        'touchstart',
        () => {
          console.time('click');
        },
        false
      );
      $btn.addEventListener(
        'click',
        () => {
          console.timeEnd('click');
          console.log('提交表单');
        },
        false
      );
    </script>
  </body>
</html>

```



### 移动端 click 事件 300ms 延迟的原因

- 原因：double-tap to zoom 双击缩放 (要检测你的操作的缩放)





### 解决方案





#### 解决方法一

- 不使用 click 事件，把 click 事件中要处理的放到 touchstart 或 touchend 中去处理

```js
$btn.addEventListener(
    'touchend',
    () => {
        console.timeEnd('click');
        console.log('提交表单');
    },
    false
);
```



#### 解决方案二

- 禁止双击缩放（浏览器厂商的努力）
  -  **https://patrickhlauke.github.io/touch/tests/results/#suppressing-300ms-delay**
  - viewport 中禁止缩放
  - touch-action: manipulation;



#### 解决方案三

- 使用 Fastclick 库
  - **https://github.com/ftlabs/fastclick**
  - 主要针对老版本浏览器



```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1,maximum-scale=1, user-scalable=no"
    />
    <title>click 事件 300ms 延迟</title>
    <style>
      .btn {
        width: 100%;
        height: 300px;
        font-size: 100px;

        /* touch-action: manipulation; */
      }
    </style>
  </head>
  <body>
    <button id="btn" class="btn">提交</button>
	  <!-- 引入Fastclick 库 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    	// 使用 Fastclick 库
      if ('addEventListener' in document) {
        document.addEventListener(
          'DOMContentLoaded',
          function () {
            FastClick.attach(document.body);
          },
          false
        );
      }

      const $btn = document.getElementById('btn');
      $btn.addEventListener(
        'touchstart',
        () => {
          console.time('click');
        },
        false
      );
      // $btn.addEventListener(
      //   'touchend',
      //   () => {
      //     console.timeEnd('click');
      //     console.log('提交表单');
      //   },
      //   false
      // );
      $btn.addEventListener(
        'click',
        () => {
          console.timeEnd('click');
          console.log('提交表单');
        },
        false
      );
    </script>
  </body>
</html>

```



### Touch事件点击穿透



> **touch 事件结束后会默认触发元素的 click 事件**，如没有设置完美视口，则事件触发的时间间隔为 300ms 左右，如设置完美视口则时间间隔为 30ms 左右（备注：具体的时间也看设备的特性）。
>
> 如果 touch 事件隐藏了元素，则 click 动作将作用到新的元素上，触发新元素的 click 事件或页面跳转，此现象称为点击穿透
>
> 



### 解决方法一

阻止默认行为

```js
//阻止默认行为
node.addEventListener('touchstart', function(e){
    console.log('hello')
	e.preventDefault(); 
})
```

### 解决方法二

使背后元素不具备click特性，用touchXxxx代替click

```js
banner_img.addEventListener('touchstart',()=>{
    location.href = 'http://www.baidu.com'
})
```

### 解决方案三

让背后的元素暂时失去click事件，300毫秒左右再复原

```css
#anode{
  pointer-events: none;
}
```

```js
btn.addEventListener('touchstart',(event)=>{
    shade.style.display =  'none'
    setTimeout(()=>{
        anode.style.pointerEvents = 'auto'
    },500)
})
```

### 解决方案四

让隐藏的元素延迟300毫秒左右再隐藏

```js
btn.addEventListener('touchstart',(event)=>{
    setTimeout(()=>{
    	shade.style.display =  'none'
    },300)
})
```



